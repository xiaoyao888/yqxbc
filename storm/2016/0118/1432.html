<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>总体认识storm包括概念，场景，组成_为你而生的编程知识网站_一起学编程</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="总体,认识,storm,包括,概念,场景,组成,阅,读本," />
  <meta name="description" content="阅读本文章可以带着下面问题： 1.storm是如何产生的？ 2.为什么storm会比其他解决方案受欢迎？ 3.storm有几个进程，各自的作用是什么？ 4.Storm记录级容错的基本原理？ 5.storm内核使用什么" />
  	<!-- Bootstrap core CSS -->
	<link href="/templets/default/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap theme -->
	<link href="/templets/default/css/bootstrap-theme.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="/templets/default/css/theme.css" rel="stylesheet">

	<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
	<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
	<script src="/templets/default/js/ie-emulation-modes-warning.js"></script>

	<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	<script src="/templets/default/js/ie10-viewport-bug-workaround.js"></script>

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<script src="/templets/default/js/jquery-2.1.3.js"></script>
	<script src="/templets/default/js/bootstrap.min.js"></script>
	<script src="/templets/default/js/docs.min.js"></script>
	<link href="/templets/default/css/main.css" rel="stylesheet">
	<script src="/templets/default/js/main.js"></script>

  <script src="/templets/default/js/article.js"></script>
  
<!-- yqxbc.com Baidu tongji analytics -->
<script>
var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?01a1ff7b6ab0650920aa64bf8bfad7e2";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body>
  <link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.css" rel="stylesheet">
<link href="/templets/default/css/header.css" rel="stylesheet">
<header id="header" class="site-header">
    <div class="container" style="margin-top:0px;">     
      <div class="row" >
        <div class="col-sm-12 col-md-12">
	        <div class="site-header-banner" style="min-height:300px;">
	        	<h2 class="title-site-name" id="title-site-name">一起学编程</h2>
	        	<div class="title-site-domain" id="title-site-domain">www.yqxbc.com</div>
	        	<div class="title-site-memo" id="title-site-memo">常用技术，开发中遇到的坑，你想要的或许这里有。</div>
	        	<div class="title-site-article-count" id="title-site-article-count">
	        		共收藏了990 篇技术文章
	        	</div>
	        	<form  method="post" id="searchFrm" class="searchFrm" role="search" action="/plus/search.php">
		            <div class="input-group">		            	
		                <input type="text" class="form-control input-group-lg" id="keyword" name="keyword" placeholder="Search">
		                <span class="input-group-btn">
		                    <button type="button" class="btn btn-default" onclick="searchKey()">搜索</button>
		                </span>
		            </div><!-- /input-group -->
	            </form>
	        </div>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-default navbar-custom">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header navbar-header-custom">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">首页</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav nav-custom">
            <li><a href="javascript:void(0);" title="SpringCloud">SpringCloud</a></li>
            <li class="dropdown">
              <a href="/bcsj" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">编程设计<span class="caret"></span></a>
              <ul class="dropdown-menu">
              
                 
                  <li><a href="/bcsj/css/" title="CSS">CSS</a> </li>
                 
                  <li><a href="/bcsj/Hadoop/" title="Hadoop">Hadoop</a> </li>
                 
                  <li><a href="/bcsj/Ajax/" title="Ajax">Ajax</a> </li>
                 
                  <li><a href="/bcsj/js/" title="Javascript">Javascript</a> </li>
                 
                  <li><a href="/bcsj/java/" title="Java">Java</a> </li>
                 
                  <li><a href="/bcsj/Jetty/" title="Jetty">Jetty</a> </li>
                 
                  <li><a href="/bcsj/Python/" title="Python">Python</a> </li>
                 
                  <li><a href="/storm/" title="Storm">Storm</a> </li>
                 
                  <li><a href="/ElasticSearch/" title="ElasticSearch">ElasticSearch</a> </li>
                 
                  <li><a href="/SpringBoot/" title="SpringBoot">SpringBoot</a> </li>
                 
                  <li><a href="/sublime/" title="Sublime">Sublime</a> </li>
                 
                  <li><a href="/SpringCloud/" title="SpringCloud">SpringCloud</a> </li>
                 
                  <li><a href="/ZooKeeper/" title="ZooKeeper">ZooKeeper</a> </li>
                 
                  <li><a href="/Git/" title="Git">Git</a> </li>
                 
                  <li><a href="/maven/" title="Maven">Maven</a> </li>
                 
                  <li><a href="/Gradle/" title="Gradle">Gradle</a> </li>
                
              
              </ul>
            </li>
            <li class="dropdown">
              <a href="/shujuku" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">数据库 <span class="caret"></span></a>
              <ul class="dropdown-menu">
                
                  <li><a href="/shujuku/redis/" title="redis">redis</a> </li>
                 
                  <li><a href="/shujuku/sqlserver/" title="SQL Server">SQL Server</a> </li>
                 
                  <li><a href="/shujuku/memcache/" title="Memcache">Memcache</a> </li>
                 
                  <li><a href="/shujuku/mysql/" title="MySql">MySql</a> </li>
                 
                  <li><a href="/shujuku/oracle/" title="Oracle">Oracle</a> </li>
                 
                  <li><a href="/shujuku/mangodb/" title="MangoDB">MangoDB</a> </li>
                 
                  <li><a href="/shujuku/hbase/" title="Hbase">Hbase</a> </li>
                 
                  <li><a href="/shujuku/access/" title="Access">Access</a> </li>
                 
                  <li><a href="/shujuku/db2/" title="DB2">DB2</a> </li>
                
              </ul>
            </li>     
            <li><a href="/dnzs" title="电脑基础知识学习，计算机技术学习网站，计算机基础知识,电脑学习">电脑知识 <span class="sr-only">(current)</span></a></li>
            <li><a href="/wlzs" title="网络知识大全">网络知识</a></li>
            <li><a href="http://www.win10os.com" title="windows10系统">windows10</a></li>      
            <li><a href="/czxt/linux" title="linux系统">linux</a></li>
            <li><a href='/erweima/' target="_blank" title="二维码生成">常用工具</a></li>
          </ul>          
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
</header><!-- /header --> 
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
       <div class="modal-dialog">
          <div class="modal-content">
             <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">搜索提示</h4>
             </div>
             <div class="modal-body">
                <div style="height:60px;line-height:60px;">关键字不能小于2个字！</div>
             </div>
          </div><!-- /.modal-content -->
       </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
<script type="text/javascript" src="/templets/default/js/header.js"></script>
  <div class="modal fade" id="imgModal" tabindex="-1" role="dialog" aria-hidden="true">
	   <div class="modal-dialog">
		  <div class="modal-content">
			 <div class="modal-body">
				<div id="modal_img" ></div>
			 </div>
		  </div>
	   </div>
	</div>
  <div class="container" style="padding-left:0px;padding-right:0px">
    
    <div class="col-sm-8  col-md-8">
      <ol class="breadcrumb">
      当前位置：<a href='http://www.yqxbc.com/'>首页</a> > <a href='/bcsj/'>编程设计</a> > <a href='/storm/'>Storm</a> >
      </ol>
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="art_title">
            <div>总体认识storm包括概念，场景，组成</div>
            <a href="http://www.yqxbc.com" title="http://www.yqxbc.com">http://www.yqxbc.com</a>&nbsp;<a href="http://www.yqxbc.com">win10系统</a>  发布时间：2016-01-18 12:24 来源：about云 浏览：<span id="count"style="font-size:14px;">加载中</span>次
          </div>
          <div class="art_body">
            <div class="art_share"><div><div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></div></div>
            <div class="col-md-12 well bg-success" role="complementary">
              <h3>文章目录</h3>
            	<nav>
            		<ul id="rootul" class="nav bs-docs-sidenav"></ul>		
            	</nav>
            </div>
            <div id="1432" class="art_content">阅读本文章可以带着下面问题：<br />
1.storm是如何产生的？<br />
<br />
2.为什么storm会比其他解决方案受欢迎？<br />
<br />
3.storm有几个进程，各自的作用是什么？<br />
<br />
4.Storm记录级容错的基本原理？<br />
<br />
<br />
5.storm内核使用什么编写的？<br />
<br />
<br />
6.storm被淘宝用来做什么？<br />
<br />
<img _load="1" alt="" border="0" file="static/image/hrline/4.gif" id="aimg_wLmFF" lazyloaded="true" lazyloadthumb="1" src="/uploads/allimg/160118/12234645F-0.gif" /><br />
<br />
<br />
淘宝场景分析：<br />
<br />
伴随着信息科技日新月异的发展，信息呈现出爆发式的膨胀，人们获取信息的途径也更加多样、更加便捷，同时对于信息的时效性要求也越来越高。举个搜索场景中的例子，当一个卖家发布了一条宝贝信息时，他希望的当然是这个宝贝马上就可以被卖家搜索出来、点击、购买啦，相反，如果这个宝贝要等到第二天或者更久才可以被搜出来，估计这个大哥就要骂娘了。再举一个推荐的例子，如果用户昨天在淘宝上买了一双袜子，今天想买一副泳镜去游泳，但是却发现系统在不遗余力地给他推荐袜子、鞋子，根本对他今天寻找泳镜的行为视而不见，估计这哥们心里就会想推荐你妹呀。其实稍微了解点背景知识的码农们都知道，这是因为后台系统做的是每天一次的全量处理，而且大多是在夜深人静之时做的，那么你今天白天做的事情当然要明天才能反映出来啦。<br />
迫切需要设计一个实时系统<br />
<br />
<br />
根据场景分析，我们迫切需要一个大数据实时系统，这个实时系统该如何设计，需要解决什么问题<br />
<br />
<br />
<br />
<ul>
	<li>
		低延迟：都说了是实时计算系统了，延迟是一定要低的。</li>
	<li>
		高性能：性能不高就是浪费机器，浪费机器是要受批评的哦。</li>
	<li>
		分布式：系统都是为应用场景而生的，如果你的应用场景、你的数据和计算单机就能搞定，那么不用考虑这些复杂的问题了。我们所说的是单机搞不定的情况。</li>
	<li>
		可扩展：伴随着业务的发展，我们的数据量、计算量可能会越来越大，所以希望这个系统是可扩展的。</li>
	<li>
		容错：这是分布式系统中通用问题。一个节点挂了不能影响我的应用。</li>
</ul>
<br />
<br />
<br />
那么如果能够解决上面问题，可以说有不少解决方案。 而且各有千秋，随便举一种方案，使用消息队列+分布在各个机器上的工作进程就ok啦。<br />
但是我们在是使用过程中如何保证质量，而且质量往往决定了受欢迎的程度。<br />
<br />
1.如何容易在上面开发应用程序。<br />
<br />
亲，你设计的系统需要应用程序开发人员考虑各个处理组件的分布、消息的传递吗？如果是，那有点麻烦啊，开发人员可能会用不好，也不会想去用。<br />
<br />
2.消息不丢失。<br />
<br />
用户发布的一个宝贝消息不能在实时处理的时候给丢了，对吧？更严格一点，如果是一个精确数据统计的应用，那么它处理的消息要不多不少才行。这个要求有点高哦。<br />
<br />
3.消息严格有序。<br />
<br />
有些消息之间是有强相关性的，比如同一个宝贝的更新和删除操作消息，如果处理时搞乱顺序完全是不一样的效果了。<br />
<br />
面对上面的的问题，和受欢迎程度-------storm横空出世<br />
<br />
我们来看一下storm的适用场景。<br />
<br />
<ul>
	<li>
		流数据处理：Storm可以用来处理源源不断流进来的消息，处理之后将结果写入到某个存储中去。</li>
	<li>
		分布式rpc：由于storm的处理组件是分布式的，而且处理延迟极低，所以可以作为一个通用的分布式rpc框架来使用。当然，其实我们的搜索引擎本身也是一个分布式rpc系统。</li>
</ul>
<br />
什么是Storm详细可以查看storm入门介绍<br />
<div>
	Storm是一个开源的实时计算系统，它提供了一系列的基本元素用于进行计算：Topology、Stream、Spout、Bolt等等。</div>
<br />
<div>
	在Storm中，一个实时应用的计算任务被打包作为Topology发布，这同Hadoop的MapReduce任务相似。但是有一点不同的是：在Hadoop中，MapReduce任务最终会执行完成后结束；而在Storm中，Topology任务一旦提交后永远不会结束，除非你显示去停止任务。</div>
<br />
<div>
	计算任务Topology是由不同的Spouts和Bolts，通过数据流（Stream）连接起来的图。下面是一个Topology的结构示意图：</div>
<div>
	<ignore_js_op><img _load="1" aid="2590" file="data/attachment/forum/201402/11/131738no75k7oz729ryk51.png" id="aimg_2590" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/12234C639-1.png" zoomfile="data/attachment/forum/201402/11/131738no75k7oz729ryk51.png" /></ignore_js_op></div>
<div>
	其中包含有：</div>
<div>
	Spout：Storm中的消息源，用于为Topology生产消息（数据），一般是从外部数据源（如Message Queue、RDBMS、NoSQL、Realtime Log）不间断地读取数据并发送给Topology消息（tuple元组）。</div>
<div>
	Bolt：Storm中的消息处理者，用于为Topology进行消息的处理，Bolt可以执行过滤， 聚合， 查询数据库等操作，而且可以一级一级的进行处理。</div>
<div>
	最终，Topology会被提交到storm集群中运行；也可以通过命令停止Topology的运行，将Topology占用的计算资源归还给Storm集群。</div>
Storm数据流模型
<div>
	数据流（Stream）是Storm中对数据进行的抽象，它是时间上无界的tuple元组序列。在Topology中，Spout是Stream的源头，负责为Topology从特定数据源发射Stream；Bolt可以接收任意多个Stream作为输入，然后进行数据的加工处理过程，如果需要，Bolt还可以发射出新的Stream给下级Bolt进行处理。</div>
<div>
	下面是一个Topology内部Spout和Bolt之间的数据流关系：</div>
<div>
	<ignore_js_op><img _load="1" aid="2591" file="data/attachment/forum/201402/11/131738a5j7iij6wsrsi7ls.png" id="aimg_2591" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/12234612c-2.png" zoomfile="data/attachment/forum/201402/11/131738a5j7iij6wsrsi7ls.png" /></ignore_js_op></div>
<div>
	Topology中每一个计算组件（Spout和Bolt）都有一个并行执行度，在创建Topology时可以进行指定，Storm会在集群内分配对应并行度个数的线程来同时执行这一组件。</div>
<div>
	那么，有一个问题：既然对于一个Spout或Bolt，都会有多个task线程来运行，那么如何在两个组件（Spout和Bolt）之间发送tuple元组呢？</div>
<div>
	Storm提供了若干种数据流分发（Stream Grouping）策略用来解决这一问题。在Topology定义时，需要为每个Bolt指定接收什么样的Stream作为其输入（注：Spout并不需要接收Stream，只会发射Stream）。</div>
<div>
	目前Storm中提供了以下7种Stream Grouping策略：Shuffle Grouping、Fields Grouping、All Grouping、Global Grouping、Non Grouping、Direct Grouping、Local or shuffle grouping，具体策略可以参考这里。</div>
<br />
首先我们通过一个 storm 和hadoop的对比来了解storm中的基本概念。<br />
<br />
<br />
首先我们通过一个 storm 和hadoop的对比来了解storm中的基本概念。<br />
<br />
<table cellspacing="0">
	<tbody>
		<tr>
			<td>
				&nbsp;</td>
			<td>
				Hadoop</td>
			<td>
				Storm</td>
		</tr>
		<tr>
			<td rowspan="3">
				系统角色</td>
			<td>
				JobTracker</td>
			<td>
				Nimbus</td>
		</tr>
		<tr>
			<td>
				TaskTracker</td>
			<td>
				Supervisor</td>
		</tr>
		<tr>
			<td>
				Child</td>
			<td>
				Worker</td>
		</tr>
		<tr>
			<td>
				应用名称</td>
			<td>
				Job</td>
			<td>
				Topology</td>
		</tr>
		<tr>
			<td>
				组件接口</td>
			<td>
				Mapper/Reducer</td>
			<td>
				Spout/Bolt</td>
		</tr>
	</tbody>
</table>
<br />
<br />
<div>
	接下来我们再来具体看一下这些概念。</div>
<ul type="1">
	<li>
		Nimbus：负责资源分配和任务调度。</li>
	<li>
		Supervisor：负责接受nimbus分配的任务，启动和停止属于自己管理的worker进程。</li>
	<li>
		Worker：运行具体处理组件逻辑的进程。</li>
	<li>
		Task：worker中每一个spout/bolt的线程称为一个task. 在storm0.8之后，task不再与物理线程对应，同一个spout/bolt的task可能会共享一个物理线程，该线程称为executor。</li>
</ul>
<div>
	下面这个图描述了以上几个角色之间的关系。<br />
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/deploy0.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2597" file="data/attachment/forum/201402/11/133728y3m310m1mjdtmx4n.jpg" id="aimg_2597" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/12234624J-3.jpg" zoomfile="data/attachment/forum/201402/11/133728y3m310m1mjdtmx4n.jpg" />&nbsp;</ignore_js_op></a><br />
	&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;图3-1</div>
<br />
<ul type="1">
	<li>
		Topology：storm中运行的一个实时应用程序，因为各个组件间的消息流动形成逻辑上的一个拓扑结构。</li>
	<li>
		Spout：在一个topology中产生源数据流的组件。通常情况下spout会从外部数据源中读取数据，然后转换为topology内部的源数据。Spout是一个主动的角色，其接口中有个nextTuple()函数，storm框架会不停地调用此函数，用户只要在其中生成源数据即可。</li>
	<li>
		Bolt：在一个topology中接受数据然后执行处理的组件。Bolt可以执行过滤、函数操作、合并、写数据库等任何操作。Bolt是一个被动的角色，其接口中有个execute(Tuple input)函数,在接受到消息后会调用此函数，用户可以在其中执行自己想要的操作。</li>
	<li>
		Tuple：一次消息传递的基本单元。本来应该是一个key-value的map，但是由于各个组件间传递的tuple的字段名称已经事先定义好，所以tuple中只要按序填入各个value就行了，所以就是一个value list.</li>
	<li>
		Stream：源源不断传递的tuple就组成了stream。</li>
</ul>
<div>
	10.&nbsp;&nbsp;stream grouping：即消息的partition方法。Storm中提供若干种实用的grouping方式，包括shuffle, fields hash, all, global, none, direct和localOrShuffle等</div>
<div>
	相比于s4, puma等其他实时计算系统，storm最大的亮点在于其记录级容错和能够保证消息精确处理的事务功能。下面就重点来看一下这两个亮点的实现原理。</div>
<ul>
	<li>
		Storm记录级容错的基本原理</li>
</ul>
<div>
	首先来看一下什么叫做记录级容错？storm允许用户在spout中发射一个新的源tuple时为其指定一个message id, 这个message id可以是任意的object对象。多个源tuple可以共用一个message id，表示这多个源 tuple对用户来说是同一个消息单元。storm中记录级容错的意思是说，storm会告知用户每一个消息单元是否在指定时间内被完全处理了。那什么叫做完全处理呢，就是该message id绑定的源tuple及由该源tuple后续生成的tuple经过了topology中每一个应该到达的bolt的处理。举个例子。在图4-1中，在spout由message 1绑定的tuple1和tuple2经过了bolt1和bolt2的处理生成两个新的tuple，并最终都流向了bolt3。当这个过程完成处理完时，称message 1被完全处理了。<br />
	&nbsp;</div>
<div>
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/message10.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2598" file="data/attachment/forum/201402/11/133728q355xttzovfxaz55.jpg" id="aimg_2598" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/1223461363-4.jpg" zoomfile="data/attachment/forum/201402/11/133728q355xttzovfxaz55.jpg" />&nbsp;</ignore_js_op></a><br />
	&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;图4-1</div>
<br />
<br />
<div>
	在storm的topology中有一个系统级组件，叫做acker。这个acker的任务就是追踪从spout中流出来的每一个message id绑定的若干tuple的处理路径，如果在用户设置的最大超时时间内这些tuple没有被完全处理，那么acker就会告知spout该消息处理失败了，相反则会告知spout该消息处理成功了。在刚才的描述中，我们提到了&rdquo;记录tuple的处理路径&rdquo;，如果曾经尝试过这么做的同学可以仔细地思考一下这件事的复杂程度。但是storm中却是使用了一种非常巧妙的方法做到了。在说明这个方法之前，我们来复习一个数学定理。</div>
<div>
	A xor A = 0.</div>
<div>
	A xor B&hellip;xor B xor A = 0，其中每一个操作数出现且仅出现两次。</div>
<div>
	storm中使用的巧妙方法就是基于这个定理。具体过程是这样的：在spout中系统会为用户指定的message id生成一个对应的64位整数，作为一个root id。root id会传递给acker及后续的bolt作为该消息单元的唯一标识。同时无论是spout还是bolt每次新生成一个tuple的时候，都会赋予该tuple一个64位的整数的id。Spout发射完某个message id对应的源tuple之后，会告知acker自己发射的root id及生成的那些源tuple的id。而bolt呢，每次接受到一个输入tuple处理完之后，也会告知acker自己处理的输入tuple的id及新生成的那些tuple的id。Acker只需要对这些id做一个简单的异或运算，就能判断出该root id对应的消息单元是否处理完成了。下面通过一个图示来说明这个过程。</div>
<br />
<div>
	<br />
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/ack10.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2592" file="data/attachment/forum/201402/11/133724y3zhqsbzp3wza3dh.jpg" id="aimg_2592" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/12234A641-5.jpg" zoomfile="data/attachment/forum/201402/11/133724y3zhqsbzp3wza3dh.jpg" /></ignore_js_op></a></div>
<div>
	<br />
	图4-1 spout中绑定message 1生成了两个源tuple，id分别是0010和1011.</div>
<br />
<div>
	<br />
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/ack20.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2593" file="data/attachment/forum/201402/11/133724de8z3v304a3r04ie.jpg" id="aimg_2593" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/12234C945-6.jpg" zoomfile="data/attachment/forum/201402/11/133724de8z3v304a3r04ie.jpg" /></ignore_js_op></a></div>
<br />
<div>
	<br />
	图4-2 bolt1处理tuple 0010时生成了一个新的tuple，id为0110.</div>
<br />
<div>
	<br />
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/ack30.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2594" file="data/attachment/forum/201402/11/133725eaj6koujikejiiij.jpg" id="aimg_2594" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/1223463118-7.jpg" zoomfile="data/attachment/forum/201402/11/133725eaj6koujikejiiij.jpg" /></ignore_js_op></a></div>
<br />
<div>
	<br />
	图4-3 bolt2处理tuple 1011时生成了一个新的tuple，id为0111.</div>
<div>
	<br />
	<a href="http://www.searchtb.com/wp-content/uploads/2012/08/ack40.jpg" target="_blank"><ignore_js_op><img _load="1" aid="2595" file="data/attachment/forum/201402/11/133726g1dmph1ohmj7x12o.jpg" id="aimg_2595" initialized="true" inpost="1" lazyloaded="true" src="/uploads/allimg/160118/1223464460-8.jpg" zoomfile="data/attachment/forum/201402/11/133726g1dmph1ohmj7x12o.jpg" /></ignore_js_op></a></div>
<br />
<div>
	<br />
	图4-4 bolt3中接收到tuple 0110和tuple 0111，没有生成新的tuple.</div>
<div>
	可能有些细心的同学会发现，容错过程存在一个可能出错的地方，那就是，如果生成的tuple id并不是完全各异的，acker可能会在消息单元完全处理完成之前就错误的计算为0。这个错误在理论上的确是存在的，但是在实际中其概率是极低极低的，完全可以忽略。</div>
<br />
Storm在淘宝<br />
<br />
由于storm的内核是clojure编写的(不过大部分的拓展工作都是java编写的)，为我们理解它的实现带来了一定的困难，好在大部分情况下storm都比较稳定，当然我们也在尽力熟悉clojure的世界。我们在使用storm时通常都是选择java语言开发应用程序。<br />
<br />
在淘宝，storm被广泛用来进行实时日志处理，出现在实时统计、实时风控、实时推荐等场景中。一般来说，我们从类kafka的metaQ或者基于hbase的timetunnel中读取实时日志消息，经过一系列处理，最终将处理结果写入到一个分布式存储中，提供给应用程序访问。我们每天的实时消息量从几百万到几十亿不等，数据总量达到TB级。对于我们来说，storm往往会配合分布式存储服务一起使用。在我们正在进行的个性化搜索实时分析项目中，就使用了timetunnel + hbase + storm + ups的架构，每天处理几十亿的用户日志信息，从用户行为发生到完成分析延迟在秒级。</div>
  		  <!-- 将此标记放在您希望显示like按钮的位置 -->          
            <div class="art_like"><div class="bdlikebutton"></div></div>
          </div>
        </div>
      </div>
      <div class="pnum">
        <div class="pages mypagelist">
          <div></div>
        </div>
      </div>
      <div class="pre_next">
        <nav>
          <ul class="pager">
            <li class="previous">上一篇：没有了 </li>
            <li class="next">下一篇：没有了 </li>
          </ul>
        </nav>
      </div>
      <div class="well"> 
    		如果你有好的<a href="http://www.win10os.com/win10zixun" title="win10资讯">win10资讯</a>或者<a href="http://www.win10os.com/win10jiqiao" title="win10教程">win10教程</a>，以及<a href="http://www.win10os.com/win10xitong" title="win10">win10</a>相关的问题想要获得<a href="http://www.win10os.com/win10xiazai" title="win10系统下载">win10系统下载</a>的关注与报道。<br/>欢迎加入发送邮件到657025171#qq.com(#替换为@)。期待你的好消息！
    	</div>  
      <div class="row"> 
         <div class="col-sm-6 col-md-6">  
            <div class="panel panel-body">
      		    <ul class="all_list">     
	             <li><a href="/storm/2016/0118/1432.html" >总体认识storm包括概念，场景，组</a><span>01.18</span></li>

	           </ul>
           </div>
        </div>
        <div class="col-sm-6 col-md-6">  
          <div class="panel panel-body">
      		   <ul class="all_list">     
	             
	          </ul>
          </div>
        </div>
      </div>
    </div>
    <!--右侧部分-->
    <div class="col-sm-4 col-md-4">
      <script src='/plus/ad_js.php?aid=12' language='javascript'></script>
      <div class="panel panel-custom panel-custom-right">
        <div class="panel-heading">最新文章>>></div>
        <div class="panel-body">
          <ul class="all_list">
            <li><a href="/storm/2016/0118/1432.html" >总体认识storm包括概念，场景，组成</a><span>01.18</span></li>
 
          </ul>
        </div>
      </div>  
      <script src='/plus/ad_js.php?aid=14' language='javascript'></script>
      <div id="scr_cont" class="panel panel-custom panel-custom-right">
        <div class="panel-heading">相关热门>>></div>
        <div class="panel-body">
          <ul class="all_list">
            <li><a href="/storm/2016/0118/1432.html" >总体认识storm包括概念，场景，组</a><span>22</span></li>
 
          </ul>
          </ul>
        </div>
      </div>
      <script src='/plus/ad_js.php?aid=15' language='javascript'></script>
    </div>
    
  </div>
  <nav class="navbar navbar-default navbar-fixed-bottom navbar-bottom-custom">
    <div class="container">
      <span class="pull-right navbar-text" id="font_smaller" onclick="changeFont('smaller')">A-</span>&nbsp;&nbsp;<span class="pull-right navbar-text" id="font_bigger" onclick="changeFont('bigger')">A+</span>
    </div>
  </nav>
  <div class="footer">
	<div class="foot">
<br/>
              一起学编程(原一起学编程网)是一家纯计算机技术学习、电脑学习、IT技术学习交流型网站，一起学编程(原一起学编程网)所载文章来源于网络，如果不慎侵犯了您的权益，请联系我们删除！站长QQ：657025171<br/>
             <a href="/aboutus.html">关于我们</a> | <a href="/dashiji.html">大事记</a> | <a href="/jiazhiguan.html">网站价值观</a> | <a href="/contactus.html">联系我们</a> | <a href="/sitemap.xml">网站地图</a> | <a href="/copyright.html">版权声明</a><br/>
            Copyright ◎ 2011 - 2016 yqxbc.com All Rights Reserved.<br/>
            yqxbc.com 版权所有 京ICP备11048740号<br/>
			
	</div>
</div> 
  <span id="count_data" style="display:none">
    <script src="/plus/count.php?view=yes&aid=1432&mid=1" type='text/javascript' language="javascript">
    </script>
  </span>
  <script type="text/javascript">
    document.getElementById('count').innerHTML = document.getElementById('count_data').innerHTML;
  </script>
    <script>
      var img = $(".art_content p").find("img")
      $.each(img,function(index,el){
        el.style.width='100%';
      });
    </script>

  <!-- 将此代码放在适当的位置，建议在body结束前 -->
  <script id="bdlike_shell"></script>
  <script>

  var bdShare_config = {

  	"type":"large",

  	"color":"blue",

  	"likeText":"内容很精彩",

  	"likedText":"您已顶过，谢谢！"

  };

  document.getElementById("bdlike_shell").src="http://bdimg.share.baidu.com/static/js/like_shell.js?t=" + Math.ceil(new Date()/3600000);

  </script>
  <script src="/templets/default/js/page-dir.js"></script>
</body>
</html>